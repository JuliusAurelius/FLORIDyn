%% Controller script
% Modifies T to set C_p and C_t which is then used to calculate the power
% and the wake. If a switch to the axial induction factor is desired, it
% should be implemented here.



% Calculate Ct and Cp based on the wind speed
T.Cp    = interp1(VCtCp(:,1),VCtCp(:,3),T.u);
T.Ct    = interp1(VCtCp(:,1),VCtCp(:,2),T.u);

% Yaw staying relative to the wind angle
T.yaw   = atan2(T.U(:,2),T.U(:,1));


% 1/2*airdensity*AreaRotor*C_P(a,yaw)*U_eff^3
T.P = 0.5*U.airDen*(T.D/2).^2.*pi.*T.Cp.*T.u.^3.* Pow.eta.*...
    cos(T.yaw-atan2(T.U(:,2),T.U(:,1))).^Pow.p_p;
powerHist(:,i)=...
    0.5*UF.airDen*(T.D/2).^2.*pi.*... %1/2*rho*A
    T.Cp ... % Cp w/o yaw
    .*T.u.^3.* Pow.eta.*... % u^3*eta
    cos(T.yaw-atan2(T.U(:,2),T.U(:,1))).^Pow.p_p; %Cp to yaw adj

% ======================================================================= %
% = Reviewed: 2020.09.28 (yyyy.mm.dd)                                   = %
% === Author: Marcus Becker                                             = %
% == Contact: marcus.becker.mail@gmail.com                              = %
% ======================================================================= %